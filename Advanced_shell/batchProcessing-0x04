#!/bin/bash

mkdir -p pokemon_data

pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Array to hold background PIDs
pids=()

for pokemon in "${pokemon_list[@]}"; do
    echo "Fetching data for $pokemon..."

    # Start curl in background
    curl -s "https://pokeapi.co/api/v2/pokemon/$pokemon" -o "pokemon_data/${pokemon}.json" &

    # Store PID of last background command
    pid=$!
    pids+=($pid)
done

# Timeout in seconds for each fetch (example: 10 seconds)
timeout=10

# Monitor all background jobs
for pid in "${pids[@]}"; do
    # Wait for process with timeout
    ( sleep $timeout && kill -0 $pid 2>/dev/null && kill $pid 2>/dev/null ) & watchdog=$!

    # Wait for curl process to finish
    wait $pid 2>/dev/null
    kill $watchdog 2>/dev/null
done

echo "All fetches complete."